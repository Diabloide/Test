if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/sw.js').then(registration => {
    console.log('Service Worker зарегистрирован:', registration.scope);

    registration.onupdatefound = () => {
      const newWorker = registration.installing;

      newWorker.onstatechange = () => {
        if (newWorker.state === 'installed') {
          // Если уже есть активный контроллер, значит новая версия установлена
          if (navigator.serviceWorker.controller) {
            // Здесь можно предложить обновиться или обновить автоматически:
            console.log('Новая версия доступна!');

            // Автоматически просим сервис-воркер перейти в активное состояние
            newWorker.postMessage('skipWaiting');
          } else {
            console.log('Сервис-воркер установлен впервые.');
          }
        }
      };
    };
  });

  // Слушаем событие controllerchange — это значит, что новый сервис-воркер активировался
  navigator.serviceWorker.addEventListener('controllerchange', () => {
    console.log('Контроллер изменился — обновляем страницу');
    window.location.reload();
  });
}


const DATA_VERSION = '9.5'; // Поменяй на '2', '3' и т.д. при обновлении вопросов
const savedVersion = localStorage.getItem('dataVersion');

if (savedVersion !== DATA_VERSION) {
  localStorage.removeItem('currentQuestions');
  localStorage.setItem('dataVersion', DATA_VERSION);
}

localStorage.removeItem('currentQuestions');
localStorage.setItem('dataVersion', DATA_VERSION);

const allQuestions = [
  //1
  {
    question: "В школе 800 учеников, из них 30% — ученики начальной школы. Среди учеников средней и старшей школы 20% изучают немецкий язык. Сколько учеников в школе изучают немецкий язык, если в начальной школе немецкий язык не изучается?", 
    options: ["112", "121", "111", "222" ],
    correctAnswer: 0 
  },

  //2
  {
    question: "В школе 1050 учеников, из них 30% — ученики начальной школы. Среди учеников средней и старшей школы 20% изучают французский язык. Сколько учеников в школе изучают французский язык, если в начальной школе французский язык не изучается?", 
    options: ["741", "147", "471", "417" ],
    correctAnswer: 1 
  },
  
  //3
  {
    question: "В школе 1240 учеников, из них 25% — ученики начальной школы. Среди учеников средней и старшей школы 40% изучают французский язык. Сколько учеников в школе изучают французский язык, если в начальной школе французский язык не изучается?",
    options: ["372", "252", "525", "273" ],
    correctAnswer: 0
  },

  //4
  {
    question: "В школе 1400 учеников, из них 30% — ученики начальной школы. Среди учеников средней и старшей школы 30% изучают французский язык. Сколько учеников в школе изучают французский язык, если в начальной школе французский язык не изучается?",
    options: ["832", "293", "392", "294" ],
    correctAnswer: 3
  },

  //5
  {
    question: "В школе 400 учеников, из них 30% — ученики начальной школы. Среди учеников средней и старшей школы 15% изучают немецкий язык. Сколько учеников в школе изучают немецкий язык, если в начальной школе немецкий язык не изучается?",
    options: ["52", "32", "42", "22" ],
    correctAnswer: 2
  },

  //6
  {
    question: "Ежемесячная плата за телефон составляет 200 рублей в месяц. В следующем году она увеличится на 2%. Сколько рублей будет составлять ежемесячная плата за телефон в следующем году?",
    options: ["105", "342", "204", "208" ],
    correctAnswer: 2
  },

  //7
  {
    question: "Ежемесячная плата за телефон составляет 250 рублей в месяц. В следующем году она увеличится на 4%. Сколько рублей будет составлять ежемесячная плата за телефон в следующем году?",
    options: ["200", "260", "373", "157" ],
    correctAnswer: 1
  },

  //8
  {
    question: "Ежемесячная плата за телефон составляет 260 рублей в месяц. В следующем году она увеличится на 4%. Сколько рублей будет составлять ежемесячная плата за телефон в следующем году?",
    options: ["270,4", "35,5", "253", "176" ],
    correctAnswer: 0
  },

  //9
  {
    question: "Ежемесячная плата за телефон составляет 200 рублей в месяц. В следующем году она увеличится на 4%. Сколько рублей будет составлять ежемесячная плата за телефон в следующем году?",
    options: ["208", "200", "137", "83" ],
    correctAnswer: 0
  },

  //10
  {
    question: "Ежемесячная плата за телефон составляет 250 рублей в месяц. В следующем году она увеличится на 2%. Сколько рублей будет составлять ежемесячная плата за телефон в следующем году?",
    options: ["252", "525", "255", "355" ],
    correctAnswer: 2
  },

  //11
  {
    question: "Железнодорожный билет для взрослого стоит 720 рублей. Стоимость билета для школьника составляет 50% от стоимости билета для взрослого. Группа состоит из 15 школьников и 2 взрослых. Сколько рублей стоят билеты на всю группу?",
    options: ["5840", "6840", "6843", "8604" ],
    correctAnswer: 1
  },

  //12
  {
    question: "Железнодорожный билет для взрослого стоит 840 рублей. Стоимость билета для школьника составляет 50% от стоимости билета для взрослого. Группа состоит из 18 школьников и 3 взрослых. Сколько рублей стоят билеты на всю группу?",
    options: ["5993", "10081", "9080", "10080" ],
    correctAnswer: 3
  },

  //13
  {
    question: "Железнодорожный билет для взрослого стоит 290 рублей. Стоимость билета для школьника составляет 50% от стоимости билета для взрослого. Группа состоит из 16 школьников и 3 взрослых. Сколько рублей стоят билеты на всю группу?",
    options: ["9013", "2191", "3190", "2190" ],
    correctAnswer: 2
  },

  //14
  {
    question: "Железнодорожный билет для взрослого стоит 530 рублей. Стоимость билета для школьника составляет 50% от стоимости билета для взрослого. Группа состоит из 14 школьников и 3 взрослых. Сколько рублей стоят билеты на всю группу?",
    options: ["5200", "5300", "5800", "5301" ],
    correctAnswer: 1
  },

  //15
  {
    question: "Железнодорожный билет для взрослого стоит 550 рублей. Стоимость билета для школьника составляет 50% от стоимости билета для взрослого. Группа состоит из 18 школьников и 4 взрослых. Сколько рублей стоят билеты на всю группу?",
    options: ["7150", "6793", "6151", "8100" ],
    correctAnswer: 0
  },

  //16
  {
    question: "В городе № живет 200 000 жителей. Среди них 15% детей и подростков. Среди взрослых жителей 45% не работает (пенсионеры, студенты, домохозяйки и т. п.). Сколько взрослых жителей работает?",
    options: ["90000", "97500", "93000", "93500" ],
    correctAnswer: 3
  },

  //17
  {
    question: "В городе N живет 500 000 жителей. Среди них 20% детей и подростков. Среди взрослых жителей 25% не работают (пенсионеры, студенты, домохозяйки и т.п.). Сколько взрослых жителей работает?",
    options: ["330000", "220000", "300000", "200000" ],
    correctAnswer: 2
  },

  //18
  {
    question: "В городе N живет 1 500 000 жителей. Среди них 20% детей и подростков. Среди взрослых жителей 35% не работают (пенсионеры, студенты, домохозяйки и т.п.). Сколько взрослых жителей работает?",
    options: ["870000", "780000", "560000", "650000" ],
    correctAnswer: 1
  },

  //19
  {
    question: "В городе N живет 200 000 жителей. Среди них 10% детей и подростков. Среди взрослых жителей 45% не работают (пенсионеры, студенты, домохозяйки и т.п.). Сколько взрослых жителей работает?",
    options: ["52000", "57354", "99000", "53012" ],
    correctAnswer: 2
  },

  //20
  {
    question: "В городе N живет 250 000 жителей. Среди них 15% детей и подростков. Среди взрослых жителей 35% не работают (пенсионеры, студенты, домохозяйки и т.п.). Сколько взрослых жителей работает?",
    options: ["138125", "235263", "5800", "2" ],
    correctAnswer: 0
  },

  //21
  {
    question: "Клиент взял в банке кредит 12 000 рублей на год под 16% годовых. Он должен погашать кредит, внося в банк ежемесячно одинаковую сумму денег, с тем, чтобы через год выплатить всю сумму, взятую в кредит, вместе с процентами. Сколько рублей он должен вносить в банк ежемесячно?",
    options: ["1161", "1261", "1260", "1160" ],
    correctAnswer: 3
  },

  //22
  {
    question: "Клиент взял в банке кредит 18 000 рублей на год под 18% годовых. Он должен погашать кредит, внося в банк ежемесячно одинаковую сумму денег, с тем, чтобы через год выплатить всю сумму, взятую в кредит, вместе с процентами. Сколько рублей он должен вносить в банк ежемесячно?",
    options: ["1538", "2880", "1770", "973" ],
    correctAnswer: 2
  },

  //23
  {
    question: "Клиент взял в банке кредит 12 000 рублей на год под 13% годовых. Он должен погашать кредит, внося в банк ежемесячно одинаковую сумму денег, с тем, чтобы через год выплатить всю сумму, взятую в кредит, вместе с процентами. Сколько рублей он должен вносить в банк ежемесячно?",
    options: ["1130", "2310", "8543", "587" ],
    correctAnswer: 0
  },

  //24
  {
    question: "Клиент взял в банке кредит 60 000 рублей на год под 17% годовых. Он должен погашать кредит, внося в банк ежемесячно одинаковую сумму денег, с тем, чтобы через год выплатить всю сумму, взятую в кредит, вместе с процентами. Сколько рублей он должен вносить в банк ежемесячно?",
    options: ["5200", "5300", "5850", "5301" ],
    correctAnswer: 2
  },

  //25
  {
    question: "Клиент взял в банке кредит 36 000 рублей на год под 15% годовых. Он должен погашать кредит, внося в банк ежемесячно одинаковую сумму денег, с тем, чтобы через год выплатить всю сумму, взятую в кредит, вместе процентами. Сколько рублей он должен вносить в банк ежемесячно?",
    options: ["5250", "4350", "3450", "5500" ],
    correctAnswer: 2
  },

  //26
  {
    question: "Среди 40 000 жителей города 60% не интересуются футболом. Среди жителей, интересующихся футболом, 80% смотрели по телевизору финал Лиги чемпионов. Сколько жителей города смотрело этот магч по телевизору?",
    options: ["2800", "13800", "12000", "12800" ],
    correctAnswer: 3
  },

  //27
  {
    question: "Среди 45 000 жителей города 30% не интересуется футболом. Среди футбольных болельщиков 80% смотрело по телевизору финал Лиги чемпионов. Сколько жителей города смотрело этот матч по телевизору?",
    options: ["25200", "25300", "25800", "25301" ],
    correctAnswer: 0
  },

  //28
  {
    question: "Среди 45 000 жителей города 60% не интересуются футболом. Среди жителей, интересующихся футболом, 75% смотрели по телевизору финал Лиги чемпионов. Сколько жителей города смотрело этот матч по телевизору?",
    options: ["23578", "13500", "12532", "10000" ],
    correctAnswer: 1
  },

  //29
  {
    question: "Среди 85 000 жителей города 40% не интересуются футболом. Среди жителей, интересующихся футболом, 90% смотрели по телевизору финал чемпионата мира. Сколько жителей города смотрело этот матч по телевизору?",
    options: ["95400", "47283", "5800,5", "45900" ],
    correctAnswer: 3
  },

  //30
  {
    question: "Среди 50 000 жителей города 40% не интересуются футболом. Среди жителей, интересующихся футболом, 70% смотрели по телевизору финал Лиги чемпионов. Сколько жителей города смотрело этот магч по телевизору?",
    options: ["21000", "13270", "14200", "53000" ],
    correctAnswer: 0
  },

  //31
  {
    question: "В сентябре 1 кг винограда стоил 60 рублей, в октябре виноград подорожал на 25%, а в ноябре еще на 20%. Сколько рублей стоил 1 кг винограда после подорожания в ноябре?",
    options: ["90", "100", "75", "89" ],
    correctAnswer: 0
  },

  //32
  {
    question: "В сентябре 1 кг винограда стоил 90 рублей, в октябре виноград подорожал на 25%, а в ноябре еще на 20%. Сколько рублей стоил 1 кг винограда после подорожания в ноябре?",
    options: ["105", "125", "135", "140" ],
    correctAnswer: 2
  },

  //33
  {
    question: "В сентябре 1 кг огурцов стоил 50 рублей, в октябре огурцы подорожали на 20%, а в ноябре еще на 20%. Сколько рублей стоил 1 кг огурцов после подорожания в ноябре?",
    options: ["52", "72", "80", "73" ],
    correctAnswer: 1
  },

  //34
  {
    question: "В сентябре 1 кг помидоров стоил 80 рублей, в октябре помидоры подорожали на 25%, а в ноябре еще на 20%. Сколько рублей стоил 1 кг помидоров после подорожания в ноябре?",
    options: ["121", "111", "130", "120" ],
    correctAnswer: 3
  },

  //35
  {
    question: "В сентябре 1 кг клубники стоил 120 рублей, в октябре клубника подорожала на 20%, а в ноябре еще на 25%. Сколько рублей стоил 1 кг клубники после подорожания в ноябре?",
    options: ["810", "100", "80", "180" ],
    correctAnswer: 3
  },

  //36
  {
    question: "Налог на доходы составляет 13% от заработной платы. Заработная плата Ивана Кузьмича равна 17 500 рублей. Какую сумму он получит после вычета налога на доходы? Ответ дайте в рублях.",
    options: ["15225", "25515", "58000", "53432" ],
    correctAnswer: 0
  },

  //37
  {
    question: "Налог на доходы составляет 13% от заработной платы. Заработная плата Ивана Кузьмича равна 13 000 рублей. Какую сумму он получит после вычета налога на доходы? Ответ дайте в рублях.",
    options: ["12422", "11311", "11310", "13130" ],
    correctAnswer: 2
  },

  //38
  {
    question: "Налог на доходы составляет 13% от заработной платы. Заработная плата Ивана Кузьмича равна 14 500 рублей. Какую сумму он получит после уплаты налога на доходы? Ответ дайте в рублях.",
    options: ["91240", "12839", "12673", "12615" ],
    correctAnswer: 3
  },

  //39
  {
    question: "Налог на доходы составляет 13% от заработной платы. Заработная плата Ивана Кузьмича равна 20 000 рублей. Сколько рублей он получит после уплаты налога на доходы?",
    options: ["12800", "17400", "13600", "51370" ],
    correctAnswer: 1
  },

  //40
  {
    question: "Налог на доходы составляет 13% от заработной платы Заработная плата Ивана Кузьмича равна 9000 рублей. Какую сумму он получит после уплаты налога на доходы? Ответ дайте в рублях.",
    options: ["7843", "1730", "7830", "7834" ],
    correctAnswer: 2
  },

  //41
  {
    question: "Держатели дисконтной карты книжного магазина получают при покупке скидку 5%. Книга стоит 200 рублей. Сколько рублей заплатит держатель дисконтной карты за эту книгу?",
    options: ["190", "172", "193", "180" ],
    correctAnswer: 0
  },

  //42
  {
    question: "Держатели дисконтной карты книжного магазина получают при покупке скидку 10%. Книга стоит 680 рублей. Сколько рублей заплатит держатель дисконтной карты за эту книгу?",
    options: ["913", "612", "632", "572" ],
    correctAnswer: 1
  },

  //43
  {
    question: "Держатели дисконтной карты книжного магазина получают при покупке скидку 3%. Книга стоит 300 рублей. Сколько рублей заплатит держатель дисконтной карты за эту книгу?",
    options: ["512", "347", "291", "139" ],
    correctAnswer: 2
  },

  //44
  {
    question: "Держатели дисконтной карты книжного магазина получают при покупке скидку 2%. Книга стоит 550 рублей. Сколько рублей заплатит держатель дисконтной карты за эту книгу?",
    options: ["721", "632", "342", "539" ],
    correctAnswer: 3
  },

  //45
  {
    question: "Держатели дисконтной карты книжного магазина получают при покупке скидку 8%. Книга стоит 450 рублей. Сколько рублей заплатит держатель дисконтной карты за эту книгу?",
    options: ["414", "415", "420", "421" ],
    correctAnswer: 0
  },

  //46
  {
    question: "В магазине вся мебель продаётся в разобранном виде. Покупатель может заказать сборку мебели на дому, стоимость которой составляет 15% от стоимости купленной мебели. Шкаф стоит 3000 рублей. Во сколько рублей обойдётся покупка этого шкафа вместе со сборкой?",
    options: ["6234", "5323", "2453", "3450" ],
    correctAnswer: 3
  },

  //47
  {
    question: "В магазине вся мебель продаётся в разобранном виде. Покупатель может заказать сборку мебели на дому, стоимость которой составляет 5% от стоимости купленной мебели. Шкаф стоит 4 200 рублей. Во сколько рублей обойдётся покупка этого шкафа вместе со сборкой?",
    options: ["9082", "5382", "7823", "4410" ],
    correctAnswer: 3
  },

  //48
  {
    question: "В магазине вся мебель продаётся в разобранном виде. Покупатель может заказать сборку мебели на дому, стоимость которой составляет 10% от стоимости купленной мебели. Шкаф стоит 3 100 рублей. Во сколько рублей обойдётся покупка этого шкафа вместе со сборкой?",
    options: ["3410", "7238", "5283", "3257" ],
    correctAnswer: 0
  },

  //49
  {
    question: "В магазине вся мебель продаётся в разобранном виде. Покупатель может заказать сборку мебели на дому, стоимость которой составляет 5% от стоимости купленной мебели. Шкаф стоит 3 500 рублей. Во сколько рублей обойдётся покупка этого шкафа вместе со сборкой?",
    options: ["3745", "2453", "3675", "9201" ],
    correctAnswer: 2
  },

  //50
  {
    question: "В магазине вся мебель продаётся в разобранном виде. Покупатель может заказать сборку мебели на дому, стоимость которой составляет 5% от стоимости купленной мебели. Шкаф стоит 3 200 рублей. Во сколько рублей обойдётся покупка этого шкафа вместе со сборкой?",
    options: ["2308", "1923", "3294", "3360" ],
    correctAnswer: 3
  },
  //51
  {
    question: "Тетрадь стоит 24 рубля. Сколько рублей заплатит покупатель за 60 тетрадей, если при покупке больше 50 тетрадей магазин делает скидку 10% от стоимости всей покупки?",
    options: ["2133", "1923", "1296", "1369" ],
    correctAnswer: 2
  },
  //52
  {
    question: "Тетрадь стоит 7 рублей. Сколько рублей заплатит покупатель за 90 тетрадей, если при покупке больше 50 тетрадей магазин делает скидку 20% от стоимости всей покупки?",
    options: ["425", "355", "405", "504" ],
    correctAnswer: 3
  },
  //53
  {
    question: "Тетрадь стоит 14 рублей. Сколько рублей заплатит покупатель за 70 тетрадей, если при покупке больше 50 тетрадей магазин делает скидку 5% от стоимости всей покупки?",
    options: ["931", "139", "391", "913" ],
    correctAnswer: 0
  },
  //54
  {
    question: "Тетрадь стоит 26 рублей. Сколько рублей заплатит покупатель за 80 тетрадей, если при покупке больше 50 тетрадей магазин делает скидку 20% от стоимости всей покупки?",
    options: ["6641", "1664", "5672", "973" ],
    correctAnswer: 1
  },
  //55
  {
    question: "Тетрадь стоит 16 рублей. Сколько рублей заплатит покупатель за 60 тетрадей, если при покупке больше 50 тетрадей магазин делает скидку 15% от стоимости всей покупки?",
    options: ["168", "816", "618", "861" ],
    correctAnswer: 1
  },
  //56
  {
    question: "При оплате услуг через платежный терминал взимается комиссия 5%. Терминал принимает суммы кратные 10 рублям. Аня хочет положить на счет своего мобильного телефона не меньше 800 рублей. Какую минимальную сумму она должна положить в приемное устройство данного терминала?",
    options: ["819", "891", "850", "918" ],
    correctAnswer: 2
  },
  //57
  {
    question: "При оплате услуг через платежный терминал взимается комиссия 5%. Терминал принимает суммы кратные 10 рублям. Аня хочет положить на счет своего мобильного телефона не меньше 300 рублей. Какую минимальную сумму она должна положить в приемное устройство данного терминала?",
    options: ["230", "320", "232", "323" ],
    correctAnswer: 1
  },
  //58
  {
    question: "При оплате услуг через платежный терминал взимается комиссия 8%. Терминал принимает суммы, кратные 10 рублям. Аня хочет положить на счет своего мобильного телефона не меньше 500 рублей. Какую минимальную сумму она должна положить в приемное устройство данного терминала?",
    options: ["550", "660", "551", "661" ],
    correctAnswer: 0
  },
  //59
  {
    question: "При оплате услуг через платежный терминал взимается комиссия 5%. Терминал принимает суммы, кратные 10 рублям. Месячная плата за интернет составляет 600 рублей. Какую минимальную сумму необходимо положить в приемное устройство терминала, чтобы на счету фирмы, предоставляющей интернет-услуги, оказалась сумма, не меньшая 600 рублей?",
    options: ["653", "631", "640", "597" ],
    correctAnswer: 2
  },
  //60
  {
    question: "При оплате услуг через платежный терминал взимается комиссия 8%. Терминал принимает суммы, кратные 10 рублям. Месячная плата за интернет составляет 300 рублей. Какую минимальную сумму необходимо положить в приемное устройство терминала, чтобы на счету фирмы, предоставляющей интернет-услуги, оказалась сумма, не меньшая 300 рублей?",
    options: ["479", "156", "245", "330" ],
    correctAnswer: 3
  },
  //61
  {
    question: "Студент получил свой первый гонорар в размере 1500 рублей за выполненный перевод. Он решил на все полученные деньги купить букет роз для своей учительницы русского языка. Какое наибольшее количество роз сможет купить студент, если удержанный у него налог на доходы составляет 13% гонорара, розы стоят 120 рублей за штуку и букет должен состоять из нечетного числа цветов?",
    options: ["3", "9", "7", "11" ],
    correctAnswer: 1
  },
  //62
  {
    question: "Студент получил свой первый гонорар в размере 1300 рублей за выполненный перевод. Он решил на все полученные деньги купить букет роз для своей учительницы английского языка. Какое наибольшее количество роз сможет купить студент, если удержанный у него налог на доходы составляет 13% гонорара, розы стоят 90 рублей за штуку и букет должен состоять из нечетного числа цветов?",
    options: ["3", "9", "7", "11" ],
    correctAnswer: 3
  },
  //63
  {
    question: "Студент получил свой первый гонорар в размере 700 рублей за выполненный перевод. Он решил на все полученные деньги купить букет тюльпанов для своей учительницы математики. Какое наибольшее количество тюльпанов сможет купить студент, если удержанный у него налог на доходы составляет 13% гонорара, тюльпаны стоят 60 рублей за штуку и букет должен состоять из нечетного числа цветов?",
    options: ["9", "13", "7", "11" ],
    correctAnswer: 0
  },
  //64
  {
    question: "В кафе действует следующее правило: на ту часть суммы заказа, которая превышает 1000 рублей, действует 20% скидка. После игры в футбол студенческая компания из 16 человек сделала заказ на 2750 рублей. Все платят поровну. Сколько рублей заплатит каждый?",
    options: ["73", "97", "348", "150" ],
    correctAnswer: 3
  },
  //65
  {
    question: "В кафе действует следующее правило: на ту часть заказа, которая превышает 1 000 рублей, действует скидка 25%. После игры в футбол студенческая компания из 20 человек сделала в кафе заказ на 3 400 рублей. Все платят поровну. Сколько рублей заплатит каждый?",
    options: ["150", "136", "140", "130" ],
    correctAnswer: 2
  },
  //66
  {
    question: "В кафе действует следующее правило: на ту часть суммы заказа, которая превышает 1 000 рублей, действует 20% скидка. После игры в футбол студенческая компания из 14 человек сделала в кафе заказ на 2 375 рублей. Все платят поровну. Сколько рублей заплатит каждый?",
    options: ["783", "435", "150", "921" ],
    correctAnswer: 2
  },
  //67
  {
    question: "Оплата за использование природного газа составляет 20 рублей на одного человека в месяц. С нового года она повысилась на 20%. Сколько должна заплатить семья из трех человек за использование природного газа за три месяца в новом году?",
    options: ["231", "216", "294", "221" ],
    correctAnswer: 1
  },
  //68
  {
    question: "Оплата за использование природного газа составляла 24 рубля на одного человека в месяц. С нового года она повысилась на 25%. Сколько рублей должна заплатить семья из четырех человек за использование природного газа за три месяца в новом году?",
    options: ["360", "354", "329", "336" ],
    correctAnswer: 0
  },
  //69
  {
    question: "Флакон шампуня стоит 160 рублей. Какое наибольшее число флаконов можно купить на 1000 рублей во время распродажи, когда скидка составляет 25%?",
    options: ["7", "8", "9", "10" ],
    correctAnswer: 1
  },
  //70
  {
    question: "Шариковая ручка стоит 40 рублей. Какое наибольшее число таких ручек можно будет купить на 900 рублей после повышения цены на 10%?",
    options: ["34", "20", "23", "17" ],
    correctAnswer: 1
  },
  //71
  {
    question: "Тетрадь стоит 40 рублей. Какое наибольшее число таких тетрадей можно будет купить на 750 рублей после понижения цены на 10%?",
    options: ["34", "23", "17", "20" ],
    correctAnswer: 3
  },
  //72
  {
    question: "Магазин закупает цветочные горшки по оптовой цене 120 рублей за штуку и продает с наценкой 20%. Какое наибольшее число таких горшков можно купить в этом магазине на 1 000 рублей?",
    options: ["5", "1", "6", "8" ],
    correctAnswer: 2
  },
  //73
  {
    question: "Оптовая цена учебника 170 рублей. Розничная цена на 20% выше оптовой. Какое наибольшее число таких учебников можно купить по розничной цене на 7000 рублей?",
    options: ["34", "31", "36", "38" ],
    correctAnswer: 0
  },
  //74
  {
    question: "Цена на электрический чайник была повышена на 16% и составила 3 480 рублей. Сколько рублей стоил чайник до повышения цены?",
    options: ["2308", "1923", "3294", "3000" ],
    correctAnswer: 3
  },
  //75
  {
    question: "Футболка стоила 800 рублей. После снижения цены она стала стоить 680 рублей. На сколько процентов была снижена цена на футболку?",
    options: ["25", "15", "13", "23" ],
    correctAnswer: 1
  },
  //76
  {
    question: "Налог на доходы составляет 13% от заработной платы. После удержания налога на доходы Мария Константиновна получила 9 570 рублей. Сколько рублей составляет заработная плата Марии Константиновны?",
    options: ["11000", "19230", "32904", "33060" ],
    correctAnswer: 0
  },
  //77
  {
    question: "Розничная цена учебника 180 рублей, а оптовая цена учебника на 20% ниже розничной. Какое наибольшее число таких учебников можно купить по оптовой цене на 10 000 рублей?",
    options: ["88", "33", "69", "96" ],
    correctAnswer: 2
  },
  //78
  {
    question: "27 выпускников школы собираются учиться в технических вузах. Они составляют 30% от числа выпускников. Сколько в школе выпускников?",
    options: ["50", "90", "70", "92" ],
    correctAnswer: 1
  },
  //79
  {
    question: "Пачка сливочного масла стоит 60 рублей. Пенсионерам магазин делает скидку 5%. Сколько рублей заплатит пенсионер за пачку масла?",
    options: ["53", "83", "65", "57" ],
    correctAnswer: 3
  },
  //80
  {
    question: "Мобильный телефон стоил 3 500 рублей. Через некоторое время цену на эту модель снизили до 2 800 рублей. На сколько процентов была снижена цена?",
    options: ["23", "20", "32", "33" ],
    correctAnswer: 1
  },
  //81
  {
    question: "Магазин делает пенсионерам скидку на определенное количество процентов от цены покупки. Пакет кефира стоит в магазине 40 рублей. Пенсионер заплатил за пакет кефира 38 рублей. Сколько процентов составляет скидка для пенсионеров?",
    options: ["25", "5", "32", "7" ],
    correctAnswer: 1
  },
  //82
  {
    question: "Товар на распродаже уценили на 45%, при этом он стал стоить 770 рублей. Сколько рублей стоил товар до распродажи?",
    options: ["1234", "1300", "1400", "1500" ],
    correctAnswer: 2
  },
  //83
  {
    question: "Товар на распродаже уценили на 30%, при этом он стал стоить 350 рублей. Сколько рублей стоил товар до распродажи?",
    options: ["401", "475", "500", "597" ],
    correctAnswer: 2
  },
  //84
  {
    question: "Футболка стоила 500 рублей. После снижения цены она стала стоить 390 рублей. На сколько процентов была снижена цена на футболку?",
    options: ["23", "22", "33", "32" ],
    correctAnswer: 1
  },
  //85
  {
    question: "Цена на электрический чайник была повышена на 20% и составила 1 440 рублей. Сколько рублей стоил чайник до повышения цены?",
    options: ["1200", "1923", "1294", "1360" ],
    correctAnswer: 0
  },
  //86
  {
    question: "Магазин делает пенсионерам скидку. Десяток яиц стоит в магазине 40 рублей, а пенсионер заплатил за них 35 рублей 60 копеек. Сколько процентов составила скидка для пенсионера?",
    options: ["7", "9", "13", "11" ],
    correctAnswer: 3
  },
  //87
  {
    question: "Одна коробка конфет стоит 180 руб. На распродаже стоимость коробки конфет снизилась на 15%. Какое наибольшее число таких коробок конфет можно приобрести на 1000 рублей?",
    options: ["3", "6", "7", "8" ],
    correctAnswer: 1
  },
  //88
  {
    question: "Магазин закупает плетеные корзины по оптовой цене 60 рублей за штуку. Торговая наценка составляет 25%. Какое наибольшее число таких корзин можно купить в этом магазине на 1 000 рублей?",
    options: ["23", "13", "32", "33" ],
    correctAnswer: 1
  },
  //89
  {
    question: "Пачка сливочного масла стоит 16 рублей. Пенсионерам магазин делает скидку 5%. Сколько рублей заплатит пенсионер за пачку масла?",
    options: ["23,5", "16,4", "15,2", "13,1" ],
    correctAnswer: 2
  },
  //90
  {
    question: "Оптовая база продает керамические кружки по цене 70 рублей за штуку. В магазине эти же кружки продаются с наценкой 15%. Какое наибольшее число таких кружек можно купить в этом магазине на 250 рублей?",
    options: ["1", "3", "2", "5" ],
    correctAnswer: 1
  },
    //91
  {
    question: "Билет на концерт стоит 80 рублей для взрослого. Для ребенка до 7 лет билет продается со скидкой 30%. Сколько денег заплатит семья из двух взрослых и одного ребенка шести лет за посещение концерта?",
    options: ["230", "192", "329", "216" ],
    correctAnswer: 3
  },
  //92
  {
    question: "По карте постоянного покупателя магазин одежды предоставляет скидку 5%. Сколько денег сэкономит постоянный покупатель, приобретая в этом магазине костюм за 5 800 рублей?",
    options: ["231", "172", "290", "356" ],
    correctAnswer: 2
  },
  //93
  {
    question: "Настольный календарь стоит 30 рублей. Какое наибольшее количество таких календарей можно купить на 500 рублей после понижения цены на 15%.",
    options: ["19", "17", "11", "9" ],
    correctAnswer: 0
  },
  //94
  {
    question: "Билет на электричку для взрослого стоит 85 рублей. Для пенсионеров билеты продаются со скидкой 10%. Сколько денег заплатит семья из двух пенсионеров за билеты на одну поездку в электричке?",
    options: ["130", "153", "129", "136" ],
    correctAnswer: 1
  },
  //95
  {
    question: "В пачке находится 25 пакетиков чая. За день в офисе израсходовали 68% содержимого пачки. Сколько пакетиков осталось на следующий день?",
    options: ["3", "8", "10", "7" ],
    correctAnswer: 1
  },
  //96
  {
    question: "Набор полотенец, который стоил 250 рублей, продается со скидкой 7%. Сколько рублей стоит два набора полотенец со скидкой?",
    options: ["430", "492", "329", "465" ],
    correctAnswer: 3
  },
  //97
  {
    question: "Шариковая ручка стоит 30 рублей. Какое наибольшее число таких ручек можно будет купить на 400 рублей после повышения цены на 10%?",
    options: ["23", "12", "22", "13" ],
    correctAnswer: 1
  },
  //98
  {
    question: "Мобильный телефон стоил 3 500 рублей. Через некоторое время цену на эту модель снизили на 30%. Сколько стал стоить мобильный телефон?",
    options: ["2450", "2923", "2294", "2360" ],
    correctAnswer: 0
  },
  //99
  {
    question: "Ежемесячная плата за телефон составляет 300 рублей в месяц. В следующем году она увеличится на 6%. Сколько рублей будет составлять ежемесячная плата за телефон в следующем году?",
    options: ["230", "318", "329", "330" ],
    correctAnswer: 1
  },
  //100
  {
    question: "Банк начисляет на срочный вклад 9% годовых. Вкладчик положил на счёт 5000 рублей. Сколько рублей будет на этом счёте через год если никаких операций, кроме начисления процентов, со счётом проводиться не будет?",
    options: ["5318", "5450", "5294", "5361" ],
    correctAnswer: 1
  },

]

let currentQuestionIndex = 0;
let userAnswers = [];
let selectedQuestions = [];

function getRandomQuestions(sourceArray, numberOfQuestions) {
  const shuffled = [...sourceArray].sort(() => 0.5 - Math.random());
  return shuffled.slice(0, numberOfQuestions);
}

function getOrGenerateQuestions() {
  let saved = localStorage.getItem('currentQuestions');
  if (saved) {
    return JSON.parse(saved);
  } else {
    const questions = getRandomQuestions(allQuestions, 10);
    localStorage.setItem('currentQuestions', JSON.stringify(questions));
    return questions;
  }
}

function loadQuiz(questions) {
  const container = document.getElementById("quiz-container");
  container.innerHTML = "";

  const q = questions[currentQuestionIndex];
  
  const questionEl = document.createElement("div");
  questionEl.innerHTML = `
    <div class="progress">Вопрос ${currentQuestionIndex + 1} из ${questions.length}</div>
    <p><strong>${q.question}</strong></p>
  `;

  q.options.forEach((option, i) => {
    const id = `q${currentQuestionIndex}_opt${i}`;
    const isChecked = userAnswers[currentQuestionIndex] === i ? 'checked' : '';

    questionEl.innerHTML += `
      <label>
        <input type="radio" name="question" value="${i}" id="${id}" ${isChecked}>
        ${option}
      </label><br>
    `;
  });

  container.appendChild(questionEl);

  // Управляем кнопкой "Проверить" из HTML
  const oldButton = document.querySelector('button[onclick="submitQuiz()"]');
  if (oldButton) {
    if (currentQuestionIndex === questions.length - 1) {
      oldButton.style.display = 'block';
      oldButton.textContent = 'Завершить тест';
      oldButton.className = 'submit-btn';
    } else {
      oldButton.style.display = 'none';
    }
  }

    // Кнопки навигации - СНАЧАЛА ДАЛЕЕ, ПОТОМ НАЗАД
  const navButtons = document.createElement("div");
  navButtons.className = "nav-buttons";

  if (currentQuestionIndex < questions.length - 1) {
    // Далее - сверху/первая кнопка
    navButtons.innerHTML += `<button onclick="nextQuestion()" class="nav-btn">Далее →</button>`;
  } else {
    // На последнем вопросе - кнопка завершения
    navButtons.innerHTML += `<button onclick="submitQuiz()" class="submit-btn">Завершить тест</button>`;
  }

  if (currentQuestionIndex > 0) {
    // Назад - снизу/вторая кнопка
    navButtons.innerHTML += `<button onclick="prevQuestion()" class="nav-btn">← Назад</button>`;
  }

  // Добавляем кнопки навигации в контейнер
  container.appendChild(navButtons);
} 

function nextQuestion() {
  saveCurrentAnswer();
  
  if (currentQuestionIndex < selectedQuestions.length - 1) {
    currentQuestionIndex++;
    loadQuiz(selectedQuestions);
  }
}

function prevQuestion() {
  saveCurrentAnswer();
  
  if (currentQuestionIndex > 0) {
    currentQuestionIndex--;
    loadQuiz(selectedQuestions);
  }
}

function saveCurrentAnswer() {
  const selected = document.querySelector('input[name="question"]:checked');
  if (selected) {
    userAnswers[currentQuestionIndex] = parseInt(selected.value);
  }
}

function submitQuiz() {
  saveCurrentAnswer();
  
  let allAnswered = true;
  let unansweredQuestions = [];

  // Проверяем все вопросы
  for (let i = 0; i < selectedQuestions.length; i++) {
    if (userAnswers[i] === undefined) {
      allAnswered = false;
      unansweredQuestions.push(i + 1);
    }
  }

  if (!allAnswered) {
    // Показываем сообщение НА СТРАНИЦЕ (не alert)
    showWarning(unansweredQuestions);
    
    // Не переходим сразу - даем пользователю прочитать сообщение
    // currentQuestionIndex = unansweredQuestions[0] - 1;
    // loadQuiz(selectedQuestions);
    return;
  }

  // Если все отвечено - считаем баллы и переходим
  let score = 0;
  for (let i = 0; i < selectedQuestions.length; i++) {
    if (userAnswers[i] === selectedQuestions[i].correctAnswer) {
      score++;
    }
  }

  localStorage.setItem('quizResult', score);
  localStorage.setItem('quizTotal', selectedQuestions.length);
  window.location.href = 'result.html';
}


function showWarning(unansweredQuestions) {
  console.log("showWarning вызвана с вопросами:", unansweredQuestions);
  
  let oldWarning = document.getElementById('warning-message');
  if (oldWarning) {
    oldWarning.remove();
  }

  let warning = document.createElement('div');
  warning.id = 'warning-message';
  
  const questionsText = unansweredQuestions.join(', ');
  warning.innerHTML = `
    <div style="color: red; font-weight: bold; text-align: center; margin: 15px 0; padding: 15px; background: #ffe6e6; border-radius: 8px; border: 2px solid #ff4444;">
      ⚠️ <strong>ВНИМАНИЕ!</strong><br>
      Вы ответили не на все вопросы!<br>
      <strong>Не отвечены вопросы: ${questionsText}</strong><br>
      <em>Пожалуйста, вернитесь и ответьте на все вопросы перед завершением теста.</em>
    </div>
  `;

  const container = document.getElementById("quiz-container");
  if (container) {
    container.insertAdjacentElement('afterbegin', warning);
    console.log("Сообщение добавлено в контейнер");

    warning.scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    setTimeout(() => {
      if (warning && warning.parentNode) {
        warning.style.transition = 'opacity 0.5s ease';
        warning.style.opacity = '0';
        setTimeout(() => {
          if (warning && warning.parentNode) {
            warning.remove();
            console.log("Сообщение скрыто");
          }
        }, 500);
      }
    }, 5000);
  } else {
    console.error("Контейнер quiz-container не найден!");
  }
}

// Инициализация
selectedQuestions = getOrGenerateQuestions();
userAnswers = new Array(selectedQuestions.length);
loadQuiz(selectedQuestions);